//How can this code be made compact , shorter and based on HOFs.


export const getMonthlyReleaseReport = async (req, res) => { 
    console.log('month and year ', req.params.month, req.params.year); 
    try {
      const invList = await InventoryModel.find().lean();
      const purchaseList=await PurchaseModel.find().lean();
      
      if (!invList || !purchaseList) {
        res.status(404);
        throw new Error("inventory or purchase data could not be fetched");
      }
      //console.log("invList : ", invList);
      const inventoryList=getReleaseMasterData(invList);
      //console.log('inventoryList : ', inventoryList);  
      const mergedData = mergeReleasedDataWithPurchaseList(inventoryList, purchaseList);
      //console.log("insided inventory Controllers : " , mergedData);
      const revisedList=getFilteredData(mergedData, req.params.month, req.params.year);
      console.log("revised list : ", revisedList);

  
      // âœ… Always return an array (empty [] if no records found)
      res.json(Array.isArray(revisedList) ? revisedList : []);
      
    } catch (error) {
      console.error(error);
      res.status(500).json({ message: "Server error" });
    }
  };


  export const getReleaseMasterData=(arr)=>{
    //console.log('arr : ', arr[0]);
    let newArr=[];
    for(let i=0; i < arr.length; i++){
      let releaseArr=arr[i].releases;
      for(let j=0; j < releaseArr.length; j++){
          let obj={};
          let objDate=releaseArr[j].releaseDate;
          
          obj.id=arr[i].id;
          obj.day=objDate.getDate();
          obj.month=objDate.toLocaleString('default', { month: 'long' });
          //date.toLocaleString('default', { month: 'long' }); 
          obj.year=objDate.getFullYear();
          obj.fy=findFyOfBuyDate(objDate);
          obj.date=formatDate(releaseArr[j].releaseDate);
          obj.quantity=releaseArr[j].qty;
          obj.amount=releaseArr[j].amt;
          obj.releasedTo=releaseArr[j].releasedTo;
          obj.releasedBy=releaseArr[j].releasedBy;
          newArr.push(obj);
      }    
    }
    return newArr;
  }


  export const mergeReleasedDataWithPurchaseList=(arr1, arr2)=>(
    arr1.reduce((acc, il) => {
      const matches = arr2.filter(pl => il.id === pl.id);
      //console.log('matches : ', matches);
      const merged = matches.map(pl => ({
        id: il.id,
        category: pl.category,
        itemName: pl.itemName,
        itemId: pl.itemId,
        fy:il.fy,
        date:il.date,
        month:monthsArray.indexOf(il.month)+1,
        monthName:il.month,
        year:il.year,
        quantity:il.quantity,
        unitDesc:pl.unitDesc,
        measType:pl.measType,
        amount:il.amount,
        releasedTo:il.releasedTo,
        releasedBy:il.releasedBy
      }));
      console.log("merged : ", merged);
      return acc.concat(merged);
    }, [])
  );

  export const getFilteredData=(md, m, y)=>{
    //console.log(md);
    let arr1=md.filter(i => i.month === Number(m));
    let arr2=arr1.filter(i => i.year === Number(y));
    //console.log(arr2);
    
    
    return arr2;
  
  }